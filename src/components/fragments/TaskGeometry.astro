---
import type { TaskInstance, GeometryData } from "@domain/task-system";
import type { Locale } from "@i18n/translations";
import { t } from "@i18n/translations";

interface Props {
    task: TaskInstance<GeometryData>;
    locale: Locale;
    sessionId: string;
}

const { task, locale, sessionId } = Astro.props;
---

<div class="slide-up">
    <div class="task-question">
        <div class="bg-white/80 rounded-xl p-4 mb-4">
            <Fragment set:html={task.data.svgMarkup} />
        </div>
        <p class="text-xl md:text-2xl">{task.data.prompt}</p>
    </div>
</div>

<form
    id="answer-form"
    hx-post="/api/test/answer"
    hx-target="#feedback-container"
    hx-swap="innerHTML"
    class="mt-6 space-y-6"
>
    <input type="hidden" name="sessionId" value={sessionId} />
    <input type="hidden" name="locale" value={locale} />
    <input type="hidden" name="taskId" value={task.id} />

    <div>
        <label for="answer" class="sr-only">{t(locale, "yourAnswer")}</label>
        <div class="flex items-center gap-3">
            <input
                type="text"
                id="answer"
                name="answer"
                class="input-field flex-1"
                placeholder={t(locale, "yourAnswer")}
                autocomplete="off"
                inputmode="decimal"
                required
                autofocus
                x-data=""
                x-on:input="$el.value = $el.value.replace(/[^0-9,.\-]/g, '')"
            />
            {
                task.inputLabel && (
                    <span class="text-2xl font-semibold text-gray-700">
                        {task.inputLabel}
                    </span>
                )
            }
        </div>
    </div>

    <button type="submit" class="btn-success w-full">
        {t(locale, "checkAnswer")}
    </button>
</form>

<div id="feedback-container" class="mt-6"></div>
