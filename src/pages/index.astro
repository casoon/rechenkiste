---
import BaseLayout from "@layouts/BaseLayout.astro";
import { t, getLocaleFromUrl, getLocalizedPath } from "@i18n/translations";
import type { Locale } from "@i18n/translations";

const locale: Locale = getLocaleFromUrl(Astro.url);
---

<BaseLayout title={t(locale, "welcome")} locale={locale}>
    <div
        class="glass-card-strong p-8 md:p-12 max-w-lg w-full bounce-in"
        transition:name="main-card"
    >
        <div class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-purple-700 mb-4">
                {t(locale, "welcome")}
            </h1>
            <p class="text-xl text-gray-600">
                {t(locale, "tagline")}
            </p>
        </div>

        <form action="/api/test/start" method="POST" class="space-y-6">
            <input type="hidden" name="locale" value={locale} />

            <!-- Klassenstufe -->
            <div class="space-y-2">
                <label
                    for="grade"
                    class="block text-lg font-bold text-gray-700"
                >
                    {t(locale, "chooseGrade")}
                </label>
                <select id="grade" name="grade" class="select-field" required>
                    <option value="1">{t(locale, "grade1")}</option>
                    <option value="2">{t(locale, "grade2")}</option>
                    <option value="3">{t(locale, "grade3")}</option>
                    <option value="4">{t(locale, "grade4")}</option>
                    <option value="5">{t(locale, "grade5")}</option>
                </select>
            </div>

            <!-- Aufgabenanzahl -->
            <div class="space-y-2">
                <label
                    for="count"
                    class="block text-lg font-bold text-gray-700"
                >
                    {t(locale, "chooseCount")}
                </label>
                <select id="count" name="count" class="select-field" required>
                    <option value="10">10 {t(locale, "tasks")}</option>
                    <option value="20">20 {t(locale, "tasks")}</option>
                    <option value="30">30 {t(locale, "tasks")}</option>
                </select>
            </div>

            <!-- Optionen (ausklappbar) -->
            <details class="group">
                <summary
                    class="flex items-center justify-between cursor-pointer p-3 bg-gray-50 rounded-xl hover:bg-gray-100 transition-colors"
                >
                    <span class="text-sm font-medium text-gray-600">
                        {t(locale, "options")}
                    </span>
                    <span
                        class="text-gray-400 group-open:rotate-180 transition-transform"
                        >â–¼</span
                    >
                </summary>
                <div class="mt-3 space-y-3 p-4 bg-purple-50 rounded-xl">
                    <label class="flex items-center gap-3 cursor-pointer">
                        <input
                            type="checkbox"
                            name="adaptive"
                            class="size-5  rounded border-purple-300 text-purple-600 focus:ring-purple-500"
                        />
                        <span class="text-gray-700"
                            >{t(locale, "adaptiveDifficulty")}</span
                        >
                    </label>

                    <label class="flex items-center gap-3 cursor-pointer">
                        <input
                            type="checkbox"
                            name="retry"
                            class="size-5  rounded border-purple-300 text-purple-600 focus:ring-purple-500"
                        />
                        <span class="text-gray-700"
                            >{t(locale, "retryIncorrect")}</span
                        >
                    </label>
                </div>
            </details>

            <!-- Start Button -->
            <div class="pt-4">
                <button type="submit" class="btn-primary w-full">
                    {t(locale, "startTest")}
                </button>
            </div>
        </form>

        <!-- Link to Custom Test -->
        <div class="mt-6 pt-6 border-t border-purple-100 text-center">
            <a
                href={getLocalizedPath("/auswahl", locale)}
                class="text-purple-600 hover:text-purple-800 font-medium transition-colors"
            >
                ðŸŽ¯ {t(locale, "customTest")}
            </a>
        </div>
    </div>
</BaseLayout>
