---
import BaseLayout from "@layouts/BaseLayout.astro";
import { t, getLocaleFromUrl } from "@i18n/translations";
import type { Locale } from "@i18n/translations";
import { loadSession, getResults } from "@domain/session";
import { renderResultFragment } from "@services/task-renderer";

const locale: Locale = getLocaleFromUrl(Astro.url);

const session = await loadSession(Astro);
if (!session) {
    return Astro.redirect(getLocalizedPath("/", locale));
}

const resultData = getResults(session);
const resultHtml = await renderResultFragment(session, resultData, locale);
---

<BaseLayout title={t(locale, "result")} locale={locale}>
    <div id="result-container" transition:name="main-card">
        <Fragment set:html={resultHtml} />
    </div>
</BaseLayout>
